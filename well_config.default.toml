# ==============================================================================
# SAIREN-OS Well Configuration
# ==============================================================================
#
# This file controls ALL drilling detection thresholds.
# If this file is absent, built-in defaults are used (matching standard values).
#
# Loading order:
#   1. Path in $SAIREN_CONFIG environment variable
#   2. ./well_config.toml (this file)
#   3. Built-in defaults
#
# You only need to include sections/values you want to override.
# Everything else falls back to the defaults shown below.
#
# IMPORTANT: Changes to [thresholds.well_control] are SAFETY-CRITICAL.
# Review with the company man and toolpusher before modifying.
# ==============================================================================

[well]
name       = "DEFAULT"
field      = ""
rig        = ""
operator   = ""
# Bit diameter affects MSE calculation and rig state classification
bit_diameter_inches = 8.5


# ==============================================================================
# WELL CONTROL THRESHOLDS (SAFETY-CRITICAL)
# ==============================================================================
# These thresholds trigger kick, loss, gas, and H2S advisories.
# On large rigs with high flow rates, increase flow_imbalance thresholds.
# On HP/HT wells, tighten gas and H2S thresholds.

[thresholds.well_control]
flow_imbalance_warning_gpm  = 10.0   # Flow out - flow in warning (gpm)
flow_imbalance_critical_gpm = 20.0   # Flow out - flow in critical (gpm)
pit_gain_warning_bbl        = 5.0    # Pit volume increase warning (bbl)
pit_gain_critical_bbl       = 10.0   # Pit volume increase critical (bbl)
pit_rate_warning_bbl_hr     = 5.0    # Pit rate warning (bbl/hr)
pit_rate_critical_bbl_hr    = 15.0   # Pit rate critical (bbl/hr)
gas_units_warning           = 100.0  # Total gas warning (gas units)
gas_units_critical          = 500.0  # Total gas critical (gas units)
h2s_warning_ppm             = 10.0   # H2S warning (ppm)
h2s_critical_ppm            = 20.0   # H2S critical (ppm)


# ==============================================================================
# MSE EFFICIENCY THRESHOLDS
# ==============================================================================
# MSE (Mechanical Specific Energy) efficiency classification.
# Lower percentages = more wasted energy.

[thresholds.mse]
efficiency_optimal_percent = 85.0    # Above this = optimal drilling
efficiency_warning_percent = 70.0    # Below this = optimisation advisory
efficiency_poor_percent    = 50.0    # Below this = poor efficiency


# ==============================================================================
# HYDRAULICS THRESHOLDS
# ==============================================================================
# Mud weight, ECD margins, and standpipe pressure deviation.
#
# CRITICAL: normal_mud_weight_ppg directly affects d-exponent accuracy.
# Set this to your actual pore pressure gradient equivalent mud weight.
# Getting this wrong corrupts the d-exponent by up to 28%.

[thresholds.hydraulics]
normal_mud_weight_ppg               = 8.6    # Normal pore pressure gradient (ppg)
fracture_gradient_ppg               = 14.0   # Fracture gradient for ECD margin (ppg)
ecd_margin_warning_ppg              = 0.3    # ECD margin to frac gradient warning (ppg)
ecd_margin_critical_ppg             = 0.1    # ECD margin to frac gradient critical (ppg)
spp_deviation_warning_psi           = 100.0  # SPP deviation from baseline warning (psi)
spp_deviation_critical_psi          = 200.0  # SPP deviation from baseline critical (psi)
annular_pressure_loss_coefficient   = 0.1    # APL estimation coefficient


# ==============================================================================
# MECHANICAL THRESHOLDS
# ==============================================================================
# Torque, pack-off, and stick-slip detection.
# Values are fractions (0.15 = 15%).

[thresholds.mechanical]
torque_increase_warning         = 0.15   # Torque increase warning (fraction)
torque_increase_critical        = 0.25   # Torque increase critical (fraction)
stick_slip_cv_warning           = 0.15   # Torque CV warning for stick-slip
stick_slip_cv_critical          = 0.25   # Torque CV critical for stick-slip
packoff_spp_increase_threshold  = 0.10   # SPP increase for pack-off detection
packoff_rop_decrease_threshold  = 0.20   # ROP decrease for pack-off detection
stick_slip_min_samples          = 5      # Minimum torque samples for analysis


# ==============================================================================
# FOUNDER (BIT BALLING) DETECTION
# ==============================================================================
# Detects when increasing WOB no longer increases ROP.

[thresholds.founder]
wob_increase_min          = 0.02   # Min WOB trend increase (fraction/sample)
rop_response_min          = 0.01   # ROP response below this = not responding
severity_warning          = 0.3    # Founder severity warning threshold
severity_high             = 0.7    # Founder severity high threshold
min_samples               = 5      # Minimum samples for reliable trend
quick_wob_delta_percent   = 0.05   # Quick (two-packet) founder WOB delta


# ==============================================================================
# FORMATION CHANGE DETECTION
# ==============================================================================
# D-exponent and MSE-based formation transition detection.

[thresholds.formation]
dexp_increase_warning   = 0.1    # D-exp increase rate warning (hard stringer)
dexp_decrease_warning   = -0.15  # D-exp decrease rate warning (soft/pressure)
mse_change_significant  = 0.20   # MSE change % for formation change
dxc_trend_threshold     = 0.05   # Dxc trend for hard stringer classification
dxc_pressure_threshold  = -0.05  # Dxc trend for abnormal pressure
mse_pressure_tolerance  = 0.10   # MSE stability range for pressure detection


# ==============================================================================
# RIG STATE CLASSIFICATION
# ==============================================================================
# Thresholds for determining rig operational state from WITS parameters.
# Adjust for your specific rig's characteristics.

[thresholds.rig_state]
idle_rpm_max           = 5.0     # RPM below this = not rotating
circulation_flow_min   = 50.0    # Flow above this = pumps running (gpm)
drilling_wob_min       = 1.0     # WOB above this = on bottom (klbs)
reaming_depth_offset   = 5.0     # Bit depth below hole depth = reaming (ft)
trip_out_hook_load_min = 200.0   # Hook load above this = tripping out (klbs)
trip_in_hook_load_max  = 50.0    # Hook load below this = tripping in (klbs)
tripping_flow_max      = 100.0   # Max flow rate during tripping (gpm)


# ==============================================================================
# OPERATION DETECTION
# ==============================================================================
# Automatic classification of special operations (milling, cement drill-out).

[thresholds.operation_detection]
milling_torque_min          = 15.0   # Min torque for milling (kft-lb)
milling_rop_max             = 5.0    # Max ROP for milling (ft/hr)
cement_drillout_wob_min     = 15.0   # Min WOB for cement drill-out (klbs)
cement_drillout_torque_min  = 12.0   # Min torque for cement drill-out (kft-lb)
cement_drillout_rop_max     = 20.0   # Max ROP for cement drill-out (ft/hr)
no_rotation_rpm_max         = 10.0   # RPM below this = not rotating
off_bottom_wob_max          = 5.0    # WOB below this = off bottom (klbs)


# ==============================================================================
# STRATEGIC VERIFICATION THRESHOLDS
# ==============================================================================
# Used by the Strategic Agent to confirm or reject tactical advisories.
# These are typically higher than tactical thresholds to reduce false positives.

[thresholds.strategic_verification]
flow_balance_confirmation_gpm   = 15.0   # Sustained flow balance for confirmation
flow_balance_critical_gpm       = 20.0   # Flow balance for critical escalation
pit_rate_confirmation_bbl_hr    = 10.0   # Sustained pit rate for confirmation
pit_rate_critical_bbl_hr        = 15.0   # Pit rate for critical escalation
flow_balance_transient_gpm      = 5.0    # Below this = transient (rejected)
pit_rate_transient_bbl_hr       = 3.0    # Below this = transient (rejected)
spp_deviation_sustained_psi     = 150.0  # SPP deviation for sustained confirmation
spp_deviation_normal_psi        = 50.0   # SPP deviation below this = normal
trend_consistency_threshold     = 0.5    # R² threshold for mechanical confirmation
formation_trend_consistency     = 0.6    # R² threshold for formation confirmation
dxc_change_threshold            = 0.1    # |dxc_trend| for formation change


# ==============================================================================
# BASELINE LEARNING
# ==============================================================================
# Controls the dynamic threshold learning system (Phase 1.5).

[baseline_learning]
warning_sigma           = 3.0    # Z-score sigma for warning threshold
critical_sigma          = 5.0    # Z-score sigma for critical threshold
min_samples_for_lock    = 100    # Minimum samples before locking baseline
min_std_floor           = 0.001  # Minimum std dev floor (prevents /0)
max_outlier_percentage  = 0.05   # Max outlier % before contamination flag
outlier_sigma_threshold = 3.0    # Sigma for outlier detection during learning


# ==============================================================================
# ADVISORY TIMING
# ==============================================================================

[advisory]
default_cooldown_seconds  = 60    # Cooldown between same-type advisories (s)
critical_bypass_cooldown  = true  # Critical tickets bypass cooldown


# ==============================================================================
# ENSEMBLE VOTING WEIGHTS
# ==============================================================================
# Weights for the 4-specialist voting system. Must sum to ~1.0.

[ensemble_weights]
mse          = 0.25   # MSE / drilling efficiency specialist
hydraulic    = 0.25   # Hydraulic specialist
well_control = 0.30   # Well control specialist (highest for safety)
formation    = 0.20   # Formation specialist


# ==============================================================================
# PHYSICS ENGINE TUNING
# ==============================================================================
# Empirical constants for physics calculations. Standard industry values.
# Only change if you have rig-specific calibration data.

[physics]
formation_hardness_base_psi     = 5000.0   # MSE for hardness=0 (very soft)
formation_hardness_multiplier   = 8000.0   # MSE increase per hardness unit
kick_min_indicators             = 2        # Min indicators to confirm kick
loss_min_indicators             = 2        # Min indicators to confirm loss
kick_gas_increase_threshold     = 50.0     # Gas increase above background (units)
kick_flow_severity_divisor      = 50.0     # Flow severity normalisation divisor
kick_pit_severity_divisor       = 20.0     # Pit severity normalisation divisor
kick_gas_severity_divisor       = 500.0    # Gas severity normalisation divisor
confidence_full_window          = 60       # Packets for full confidence (1Hz = 60s)
min_rop_for_mse                 = 0.1      # Min ROP for MSE rotary component (ft/hr)


# ==============================================================================
# CAMPAIGN-SPECIFIC OVERRIDES
# ==============================================================================
# When a campaign is active, these values override the top-level thresholds.
# Only include values you want different from the base thresholds.

[campaign.production]
mse_efficiency_warning  = 70.0
mse_efficiency_poor     = 50.0
flow_imbalance_warning  = 10.0
flow_imbalance_critical = 20.0
weight_mse              = 0.25
weight_hydraulic        = 0.25
weight_well_control     = 0.30
weight_formation        = 0.20

[campaign.plug_abandonment]
mse_efficiency_warning    = 50.0   # Relaxed - not drilling for ROP
mse_efficiency_poor       = 30.0   # Relaxed
flow_imbalance_warning    = 5.0    # Tighter - cement returns matter
flow_imbalance_critical   = 15.0   # Tighter
pressure_test_tolerance   = 25.0   # Tighter tolerance for P&A
cement_pressure_hold      = 500.0  # Hold pressure for cement test (psi)
barrier_pressure_margin   = 100.0  # Margin on barrier tests (psi)
weight_mse                = 0.10   # Reduced - efficiency less critical
weight_hydraulic          = 0.35   # Increased - cement/mud critical
weight_well_control       = 0.40   # Increased - barrier integrity
weight_formation          = 0.15   # Reduced
cement_returns_expected   = true
plug_depth_tolerance      = 5.0    # Feet tolerance for plug setting
